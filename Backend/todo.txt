//TODO - Backend

const { toNamespacedPath } = require("path");

// ERASE jack admin vacations !! he is not allwoed to follow vacations!! well actually he can i guess ?? 

//change config  ( enter database )
//change ssl from CA

put back express rate limit 











sql: 
// query example of triple join  טבלת נרמול and there 2 tables"
// SELECT j.studentId, s.studentId ,  s.firstName, c.courseId, j.courseId, c.courseName, c.hours
// FROM students as s
// inner JOin studentcourses as j 
//  on s.studentId = j.studentId
//  inner join courses as c 
//    on c.courseId = j.courseId;


// SELECT u.userId, f.userId,  u.firstName, v.vacationId, f.vacationId, v.destination
// FROM users as u
// inner JOin followers as f
//  on u.userId = f.userId
//  inner join vacations as v
//   on v.vacationId = f.vacationId;

// where Year(o.orderrDate) = 1997

//!!! ANSEWRs 

//! answer to get count of vacations !!!  GOOD for graph !! 
// SELECT  v.destination, COUNT(f.vacationId)  AS vacationCount
// FROM followers AS f
//  INNER JOIN vacations as v
//  on v.vacationId = f.vacationId
// GROUP BY f.vacationId;



// Paris Italy  Spain 
// 2        2     3
 
// looks like this three rows of objects in sql table : 
// ??????????
[{
    destination: 'Paris',
    vacationCount: 2
}
{
    destination: 'Italy',
    vacationCount: 2
}
{
    destination: 'Spain',
    vacationCount: 3
[}

    // ??????????
// actualy i think i get this : 
[      {Paris: 2},
       {Italy: 2},
       {Spain: 3}  
]

//! answer also for !! 30!  circle!!  all the followers
// SELECT  v.destination, COUNT(f.vacationId)  AS vacationCount
// FROM followers AS f
//  INNER JOIN vacations as v
//  on v.vacationId = f.vacationId
// GROUP BY f.vacationId;


// part 2 all the vacations that he follows: by userId :  

SELECT * 
FROM followers
WHERE userId = 'DDAF35A193617ABACC417349AE20413112E6';

DDAF35A193617ABACC417349AE20413112E6
  vacationId 1
DDAF35A193617ABACC417349AE20413112E6
 vacationId 2
DDAF35A193617ABACC417349AE20413112E6
  vacationId 3


SELECT * 
FROM followers
WHERE userId =     'sd65f4sd65f4sd5f4ds65f4ds5dfdfddsfds';


Full texts
userId  sd65f4sd65f4sd5f4ds65f4ds5dfdfddsfds
vacationId 3


//!!! ANSWERR
SELECT u.userId, u.firstName, v.vacationId, v.destination
from users as u
inner join followers as f
 on u.userId = f.userId
inner Join vacations as v 
  on f.vacationId = v.vacationId
WHERE u.userId = 'DDAF35A193617ABACC417349AE20413112E6';

// DDAF35A193617ABACC417349AE20413112E6
// Jack 
// 1
// Paris 
// DDAF35A193617ABACC417349AE20413112E6
// Jack 
// 2
// Italy 
// DDAF35A193617ABACC417349AE20413112E6
// Jack 
// 3
// Spain


// 3rd information :::::
SELECT * FROM vacations;


// this gives me all vacations without names 
SELECT v.* , f.vacationId
FROM vacations as v
LEFT JOIN followers as f 
  on v.vacationId = f.vacationId;
  


  // better //!!! th eboce is good for graph so we want inner join but for rest of it we wwant left join !! 
  //so this gives me quanitty 30 of vacations and as well gives me quantity of those without.
  SELECT  v.destination, COUNT(f.vacationId) AS vacationCount
FROM vacations AS v
 LEFT JOIN followers as f
 on v.vacationId = f.vacationId
GROUP BY f.vacationId;


Germany
0      //! shows germany as 0 
Paris demo
2
Italy demo
2
Spain demo
3

//!!!!!!!!!!!!!!!!!!!!!!!! this is what we want !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SELECT  v.*, COUNT(f.vacationId) AS vacationCount
FROM vacations AS v
 LEFT JOIN followers as f
 on v.vacationId = f.vacationId
GROUP BY f.vacationId;

//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!this is what i need also only the vacations taht user 1 folows 
SELECT * 
FROM followers 
WHERE userId = '013e34b0-355c-45ec-a69d-5290397f13bd';


// פשוט: 
// SELECT *
// FROM (SELECT *
//       FROM vacations) AS A 
// JOIN (SELECT * 
//       FROM followers) AS B 
//  ON A.vacationId = B.vacationId;


// מחובר!! 

SELECT *
FROM  (SELECT  v.*, COUNT(f.vacationId) AS vacationCount
FROM vacations AS v
 LEFT JOIN followers as f
 on v.vacationId = f.vacationId
GROUP BY f.vacationId) AS A
LEFT JOIN ( SELECT * 
FROM followers 
WHERE userId = '013e34b0-355c-45ec-a69d-5290397f13bd') AS B

ON A.vacationId = B.vacationId;



this we need!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SELECT  v.*, COUNT(f.vacationId) AS vacationCount
FROM vacations AS v
 LEFT JOIN followers as f
 on v.vacationId = f.vacationId
GROUP BY f.vacationId;

this we need!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

SELECT u.userId, u.firstName, v.vacationId, v.destination
from users as u
inner join followers as f
 on u.userId = f.userId
inner Join vacations as v 
  on f.vacationId = v.vacationId
WHERE u.userId = '013e34b0-355c-45ec-a69d-5290397f13bd';